"use strict";const s=require("./jsx-runtime-nZSsnGb7.cjs"),c=require("react"),m=require("./toDate-CzgAa_PT.cjs"),U=require("./Button-BVYvDTtH.cjs");function W(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const i in e)if(i!=="default"){const n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:()=>e[i]})}}return t.default=e,Object.freeze(t)}const b=W(c);var k=new Map,S=new WeakMap,P=0,X;function K(e){return e?(S.has(e)||(P+=1,S.set(e,P.toString())),S.get(e)):"0"}function F(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?K(e.root):e[t]}`).toString()}function G(e){const t=F(e);let i=k.get(t);if(!i){const n=new Map;let d;const o=new IntersectionObserver(l=>{l.forEach(a=>{var p;const N=a.isIntersecting&&d.some(v=>a.intersectionRatio>=v);e.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=N),(p=n.get(a.target))==null||p.forEach(v=>{v(N,a)})})},e);d=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:o,elements:n},k.set(t,i)}return i}function H(e,t,i={},n=X){if(typeof window.IntersectionObserver>"u"&&n!==void 0){const p=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:p,intersectionRect:p,rootBounds:p}),()=>{}}const{id:d,observer:o,elements:l}=G(i),a=l.get(e)||[];return l.has(e)||l.set(e,a),a.push(t),o.observe(e),function(){a.splice(a.indexOf(t),1),a.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),k.delete(d))}}function J({threshold:e,delay:t,trackVisibility:i,rootMargin:n,root:d,triggerOnce:o,skip:l,initialInView:a,fallbackInView:p,onChange:N}={}){var v;const[w,E]=b.useState(null),_=b.useRef(N),x=b.useRef(a),[h,A]=b.useState({inView:!!a,entry:void 0});_.current=N,b.useEffect(()=>{if(x.current===void 0&&(x.current=a),l||!w)return;let g;return g=H(w,(R,D)=>{const C=x.current;x.current=R,!(C===void 0&&!R)&&(A({inView:R,entry:D}),_.current&&_.current(R,D),D.isIntersecting&&o&&g&&(g(),g=void 0))},{root:d,rootMargin:n,threshold:e,trackVisibility:i,delay:t},p),()=>{g&&g()}},[Array.isArray(e)?e.toString():e,w,d,n,o,l,i,p,t]);const y=(v=h.entry)==null?void 0:v.target,M=b.useRef(void 0);!w&&y&&!o&&!l&&M.current!==y&&(M.current=y,A({inView:!!a,entry:void 0}),x.current=a);const j=[E,h.inView,h.entry];return j.ref=j[0],j.inView=j[1],j.entry=j[2],j}const Q=async e=>{if(process.env.NODE_ENV==="development")try{return(await m.axios.get(`http://localhost:3001/api/ads/${e.ad_id}`,{params:{ad_id:e.ad_id}})).data.result}catch{}return m.axios.get(e.url,{params:{ad_id:e.ad_id}}).then(t=>t.data.result)},Y=60,Z={dedupingInterval:1e3*60*Y},ee=e=>{const{data:t,error:i,isLoading:n,mutate:d}=m.useSWR(e?{url:`https://articles.media/api/ads/${e}`,ad_id:e}:null,Q,Z);return{data:t,error:i,isLoading:n,mutate:d}};function se(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function te(e,t){return+m.toDate(e)-+m.toDate(t)}function T(e,t,i){const n=te(e,t)/m.millisecondsInMinute;return se(i?.roundingMethod)(n)}function V(e){return Math.trunc(e*m.millisecondsInMinute)}const re=async e=>{if(process.env.NODE_ENV==="development")try{return(await m.axios.get("http://localhost:3001/api/ads",{params:{}})).data}catch{}return m.axios.get(e.url,{params:{}}).then(t=>t.data)},L=60,ne={dedupingInterval:V(L),focusThrottleInterval:V(L)},oe=e=>{const{data:t,error:i,isLoading:n,mutate:d}=m.useSWR({url:"https://articles.media/api/ads"},re,ne);return{data:t,error:i,isLoading:n,mutate:d}},ie=c.lazy(()=>Promise.resolve().then(()=>require("./AdDetailsModal-CHgLXn9p.cjs"))),ae=c.lazy(()=>Promise.resolve().then(()=>require("./AdConfirmExitModal-BRpOrF3L.cjs")));function ce(e,t){return Math.floor(Math.random()*(t-e+1))+e}function le(e){const i=[],{data:n}=oe();let{previewMode:d}=e,o=e.previewData||{};const[l,a]=c.useState(null),[p,N]=c.useState(null),[v,w]=c.useState(null),[E,_]=c.useState(null),[x,h]=c.useState(0),[A,y]=c.useState(!1),[M,j]=c.useState(!1),[g,R]=c.useState(!1),[D,C]=c.useState(new Date),[$,B]=c.useState([]),{data:r}=ee(l);c.useEffect(()=>{n&&n?.length>0&&!l&&(console.log("Ad Mounted or reduxAds changed"),a(e.ad_id||n[ce(0,n?.length-1)]?._id))},[n]),c.useEffect(()=>{},[r]),c.useEffect(()=>{r?.populated_promos&&x>=0&&_(r?.populated_promos[x])},[x,r]);function q(){j(!M)}const{ref:z,inView:I}=J({threshold:0,triggerOnce:!0});function O(u){if(d&&console.log("Preventing this event from being logged as this ad is being shown in preview mode."),$.find(f=>f==u)){console.log("Already logged this event");return}m.axios.get("/api/ads/event",{params:{ad_id:r?._id,event:u}}).then(function(f){B([...$,u]),console.log(f.data)}).catch(function(f){console.log(f)})}return c.useEffect(()=>{if(!d&&(console.log("inView",I),I&&l)){let u=[{ad_id:l,date:new Date().toString()},...i.filter(f=>{if(console.log(T(new Date,new Date(f.date))),T(new Date,new Date(f.date))>5){console.log("adsViewed - Remove Old Ad View Object");return}else return console.log("adsViewed - Keep Ad View Object"),f})];console.log("unexpiredRecentViews",u)}},[I,l]),s.jsxRuntimeExports.jsxs("div",{ref:z,className:"ad-wrap",style:{"--articles-ad-background-color":o.background_color||r?.background_color,"--articles-ad-font-color":o.font_color||r?.font_color,"--articles-ad-border-color":o.border_color||r?.border_color},children:[M&&s.jsxRuntimeExports.jsx(ie,{setModalShow:j,ad:r,previewData:o}),g&&s.jsxRuntimeExports.jsx(ae,{setModalShow:R,ad:r,previewData:o}),s.jsxRuntimeExports.jsx("div",{className:"ad",children:s.jsxRuntimeExports.jsxs("div",{className:"main-panel",children:[s.jsxRuntimeExports.jsx("div",{className:"ad-warning flex-header",children:s.jsxRuntimeExports.jsxs("div",{className:"",children:[r?.city&&"Local"," Advertisement"]})}),s.jsxRuntimeExports.jsxs("div",{className:"content-wrap",children:[s.jsxRuntimeExports.jsxs("div",{className:"photo-banner",children:[s.jsxRuntimeExports.jsx("div",{className:"logo",children:(o.logo?.location||r?.logo?.location)&&s.jsxRuntimeExports.jsx("img",{src:o?.logo?.key?`${process.env.NEXT_PUBLIC_CDN}${o?.logo?.key}`:`${process.env.NEXT_PUBLIC_CDN}${r?.logo?.key}`,alt:""})}),s.jsxRuntimeExports.jsx("div",{className:"icon d-none",children:s.jsxRuntimeExports.jsx("i",{className:"fas fa-mug-hot"})}),s.jsxRuntimeExports.jsx("img",{className:"photo",src:o?.background?.key?`${process.env.NEXT_PUBLIC_CDN}${o.background?.key}`:`${process.env.NEXT_PUBLIC_CDN}${r?.background?.key}`,alt:""})]}),s.jsxRuntimeExports.jsxs("div",{className:"details-wrap",children:[s.jsxRuntimeExports.jsxs("div",{className:"detail-title",children:[s.jsxRuntimeExports.jsx("div",{className:"detail",children:s.jsxRuntimeExports.jsx("span",{className:"h4",children:o?.business||r?.business})}),s.jsxRuntimeExports.jsxs("div",{className:"flex flex-column d-none",children:[s.jsxRuntimeExports.jsxs("div",{className:"detail",children:[s.jsxRuntimeExports.jsx("span",{className:"icon",children:s.jsxRuntimeExports.jsx("i",{className:"fas fa-search-location"})}),s.jsxRuntimeExports.jsxs("span",{children:[r?.city,", ",r?.state]})]}),s.jsxRuntimeExports.jsxs("div",{className:"detail",children:[s.jsxRuntimeExports.jsx("span",{className:"icon",children:s.jsxRuntimeExports.jsx("i",{className:"fas fa-clock me-2"})}),s.jsxRuntimeExports.jsx("span",{children:"6:30AMâ€“8PM"})]})]})]}),r?.city&&s.jsxRuntimeExports.jsx("div",{className:"details mb-3 d-none"}),s.jsxRuntimeExports.jsx("div",{className:"short-description",children:o?.description||r?.description})]})]}),(!1)?.roles?.isDev&&r?.populated_promos?.length>0&&s.jsxRuntimeExports.jsxs("div",{children:[E&&s.jsxRuntimeExports.jsx("div",{className:"promos-wrap",children:E&&s.jsxRuntimeExports.jsxs("div",{className:"promo-wrap d-flex justify-content-between align-items-center mx-2 p-1 px-2 border border-2 border-light mb-0",children:[s.jsxRuntimeExports.jsxs("div",{className:"",children:[s.jsxRuntimeExports.jsx("div",{children:E.title}),s.jsxRuntimeExports.jsx("div",{className:"small",children:s.jsxRuntimeExports.jsx("div",{className:"small",children:E.details})})]}),s.jsxRuntimeExports.jsx(U.ArticlesButton,{className:"px-3",small:!0,onClick:()=>{console.log("Load Save Modal"),y(!0)},children:"Save"})]},E._id)}),s.jsxRuntimeExports.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsxRuntimeExports.jsxs("div",{className:"px-2",children:[r?.populated_promos?.length," Promos Active"]}),s.jsxRuntimeExports.jsxs("div",{className:"controls",children:[s.jsxRuntimeExports.jsx("i",{className:"fad fa-arrow-circle-left",type:"button",onClick:()=>{x==0?h(r?.populated_promos?.length-1):h(u=>u-1)}}),r?.populated_promos?.map((u,f)=>s.jsxRuntimeExports.jsx("i",{className:`fa-square ${f==x?"fad":"fas"}`},u._id)),s.jsxRuntimeExports.jsx("i",{className:"fad fa-arrow-circle-right",type:"button",onClick:()=>{x==r?.populated_promos?.length-1?h(0):h(u=>u+1)}})]})]})]}),s.jsxRuntimeExports.jsx("hr",{style:{borderColor:"white"},className:"mt-auto mb-0"}),s.jsxRuntimeExports.jsxs("div",{className:"action-wrap d-flex justify-content-lg-between px-3 py-2",children:[s.jsxRuntimeExports.jsx("div",{onClick:()=>{q(),O("Details")},className:"action flex-grow-1 flex-shrink-0",children:"Details"}),s.jsxRuntimeExports.jsx("span",{className:"px-4"}),s.jsxRuntimeExports.jsx("a",{className:"action flex-grow-1 flex-shrink-0",href:r?.website,target:"_blank",rel:"noreferrer",onClick:u=>{u.preventDefault(),R(!0),O("Confirm Exit Modal Opened")},children:s.jsxRuntimeExports.jsx("div",{children:"Website"})})]})]})}),!d&&s.jsxRuntimeExports.jsx("div",{className:"advertise-with-us p-1",style:{backgroundColor:o.background_color||r?.background_color,color:o.font_color||r?.font_color,borderColor:o.border_color||r?.border_color},children:s.jsxRuntimeExports.jsxs(m.Link,{className:"small d-block w-100 text-center",href:"https://articles.media/advertising",newPage:!0,children:[s.jsxRuntimeExports.jsx("i",{className:"fas fa-share me-1"}),"Advertise with Articles Media!"]})})]})}const de=c.memo(le);module.exports=de;
